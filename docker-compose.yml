services:
  mariadb:
    build:
      context: ./srcs/requirements/mariadb
    env_file: .env
    environment:
      MYSQL_PASSWORD_FILE: /run/secrets/db_password
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/db_root_password
    volumes:
      # Use a bind mount to the specific host directory
      - /home/juitz/data/mariadb:/var/lib/mysql
      - ./secrets/db_password.txt:/run/secrets/db_password:ro
      - ./secrets/db_root_password.txt:/run/secrets/db_root_password:ro
    networks:
      - inception_net
    restart: always

  wordpress:
    build:
      context: ./srcs/requirements/wordpress
    env_file: .env
    environment:
      WORDPRESS_DB_PASSWORD_FILE: /run/secrets/db_password
    volumes:
      # Use a bind mount to the specific host directory
      - /home/juitz/data/wordpress:/var/www/html
      - ./secrets/db_password.txt:/run/secrets/db_password:ro
    depends_on:
      - mariadb
    networks:
      - inception_net
    restart: always

  nginx:
    build:
      context: ./srcs/requirements/nginx
    ports:
      - "443:443"
    networks:
      - inception_net
    volumes:
      # Nginx also needs access to the WordPress files. Mount the same host directory.
      - /home/juitz/data/wordpress:/var/www/html
    depends_on:
      - wordpress

networks:
  inception_net:
    driver: bridge

# volumes:
#   wordpress_data:
#   mariadb_data: